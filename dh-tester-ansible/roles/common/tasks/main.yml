- hosts: hadoop-servers
  vars:
    home: /data
    jdk_file: jdk-8u152-linux-x64
  tasks:
  #   - name: genenrate rsa
  #     shell: ssh-keygen -t rsa
  #     when: master is defined
    
    - name: ssh-copy-id
      shell: ssh-copy-id -i ~/.ssh/id_rsa.pub
      when: slave is defined
      tags:
        - rsa
    
    - name: chmod 600 for rsa
      shell: chmod 0600 ~/.ssh/authorized_keys
      tags:
        - rsa
    
    - name: copy jdk to clients
      unarchive:
        src: ../files/{{jdk_file}}.tar.gz
        dest: "{{home}}"
      tags:
        - install_java
    
    - name: setup JAVA_HOME
      shell: echo "export JAVA_HOME={{home}}/{{jdk_file}}" >> ~/.bashrc && source ~/.bashrc
      tags:
        - config_java
        - install_java